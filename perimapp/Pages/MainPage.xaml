<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="perimapp.Pages.MainPage"
             xmlns:localModels="clr-namespace:perimapp.Models"          
             xmlns:localConverters="clr-namespace:perimapp.Converters"  
             Title="Mes Produits">

    <ContentPage.Resources>
        <localConverters:DlcColorConverter x:Key="dlcColorConverter" />
    </ContentPage.Resources>

    <ContentPage.Content>
        <!-- Header -->
        <Grid RowDefinitions="Auto,*"> <Grid Grid.Row="0" BackgroundColor="#58BF7F" HeightRequest="65" Padding="10,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Button Profil -->
                <Button Grid.Column="0"
                        Clicked="OnProfileIconClicked"
                        BackgroundColor="LightGray"
                        WidthRequest="45"
                        HeightRequest="45"
                        VerticalOptions="Center"
                        HorizontalOptions="Center"
                        CornerRadius="40"
                        Margin="2,0,0,0" />

                <!-- Title "Vos Produits" -->
                <Label Grid.Column="1"
                       Text="Vos Produits"
                       TextColor="White"
                       FontSize="35" 
                       FontAttributes="Bold"
                       VerticalOptions="Center"
                       HorizontalOptions="Center" />

                <!-- Button "Add Product" -->
                <Button Grid.Column="2"
                        Text="+"
                        Clicked="OnAddProductClicked"
                        FontSize="40"
                        TextColor="White"
                        BackgroundColor="#58BF7F"
                        WidthRequest="40"
                        HeightRequest="40"
                        CornerRadius="5" 
                        VerticalOptions="Center"
                        HorizontalOptions="Center"
                        Padding="0, -10, 0, 0" />
            </Grid>
            <!-- Cards Product -->
            <CollectionView Grid.Row="1" ItemsSource="{Binding Products}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="localModels:ProductMainPage"> 
                        <Border Padding="0"
                                Stroke="LightGray"
                                StrokeThickness="0.1"
                                BackgroundColor="White">
                            <Border.Shadow>
                                <Shadow Brush="LightGray" Offset="0,0" Radius="5" Opacity="0.5" />
                            </Border.Shadow>
                            
                            <Grid HeightRequest="100">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Image Product -->
                                <Image Grid.Column="0"
                                       Source="{Binding url_image}"
                                       WidthRequest="90"
                                       HeightRequest="90"
                                       Aspect="AspectFill"
                                       Margin="5,0,0,0"
                                       VerticalOptions="Center"/>

                                <!-- Text Product -->
                                <VerticalStackLayout Grid.Column="1"
                                                     VerticalOptions="Center"
                                                     Padding="10,0">
                                    <!-- Name Product -->
                                    <Label Text="{Binding product_name}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           LineBreakMode="TailTruncation"  MaxLines="2"
                                           TextColor="Black"/>
                                    <!-- Quantity Product -->
                                    <Label Text="{Binding product_quantity}"
                                           FontSize="14"
                                           TextColor="Gray"/>
                                    <!-- DLC Product -->
                                    <Label Text="{Binding product_dlc, StringFormat='DLC: {0:dd/MM/yyyy}'}"
                                           FontSize="12"
                                           TextColor="DarkGray"/>
                                </VerticalStackLayout>

                                <!-- Pastille, Remaining Days Text -->
                                <Border Grid.Column="2"
                                        BackgroundColor="{Binding DaysRemaining, Converter={StaticResource dlcColorConverter}}"
                                        HorizontalOptions="End"     
                                        VerticalOptions="Fill"    
                                        WidthRequest="60"  
                                        Padding="0"                 
                                        Margin="0,0,0,0"           
                                        StrokeShape="RoundRectangle 50,0,50,0"
                                        StrokeThickness="0"> <Label Text="{Binding DaysRemainingText}"
                                                                    TextColor="White"
                                                                    VerticalOptions="Center" HorizontalOptions="Center" FontSize="20"
                                                                    FontAttributes="Bold"/>
                                </Border>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </ContentPage.Content>
</ContentPage>