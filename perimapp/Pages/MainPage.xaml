<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="perimapp.Pages.MainPage"
             xmlns:localModels="clr-namespace:perimapp.Models"          
             xmlns:localConverters="clr-namespace:perimapp.Converters"  
             Title="Mes Produits">

    <ContentPage.Resources>
        <localConverters:DlcColorConverter x:Key="dlcColorConverter" />
    </ContentPage.Resources>

    <CollectionView ItemsSource="{Binding Products}">
        <CollectionView.ItemTemplate>
            <DataTemplate x:DataType="localModels:ProductMainPage"> 
                <Border Padding="0"
                        Stroke="LightGray"
                        StrokeThickness="0.2"
                        BackgroundColor="White">
                    <Border.Shadow>
                        <Shadow Brush="LightGray" Offset="0,0" Radius="5" Opacity="0.5" />
                    </Border.Shadow>
                    
                    <Grid HeightRequest="100">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Image Grid.Column="0"
                               Source="{Binding url_image}"
                               WidthRequest="90"
                               HeightRequest="90"
                               Aspect="AspectFill"
                               Margin="5,0,0,0"
                               VerticalOptions="Center"/>

                        <VerticalStackLayout Grid.Column="1"
                                             VerticalOptions="Center"
                                             Padding="10,0">
                            <Label Text="{Binding product_name}"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   LineBreakMode="TailTruncation"  MaxLines="2"
                                   TextColor="Black"/>
                            <Label Text="{Binding product_quantity}"
                                   FontSize="14"
                                   TextColor="Gray"/>
                            <Label Text="{Binding product_dlc, StringFormat='DLC: {0:dd/MM/yyyy}'}"
                                   FontSize="12"
                                   TextColor="DarkGray"/>
                        </VerticalStackLayout>

                        <Border Grid.Column="2"
                                BackgroundColor="{Binding DaysRemaining, Converter={StaticResource dlcColorConverter}}"
                                HorizontalOptions="End"     
                                VerticalOptions="Fill"    
                                WidthRequest="60"  
                                Padding="0"                 
                                Margin="0,0,0,0"           
                                StrokeShape="RoundRectangle 50,0,50,0">
                             <Label Text="{Binding DaysRemainingText}"
                                    TextColor="White"
                                    VerticalOptions="Center" HorizontalOptions="Center" FontSize="20"
                                    FontAttributes="Bold"/>
                        </Border>
                    </Grid>
                </Border>
            </DataTemplate>
        </CollectionView.ItemTemplate>
    </CollectionView>
</ContentPage>